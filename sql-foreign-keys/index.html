<!DOCTYPE HTML>
<html>

<head>
	<title>Code Koala by BIBI</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="/assets/css/main.css" />
	<link rel="shortcut icon" type="image/png" href="/images/koala.png" />
</head>

<body class="single is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header"></header>

		<!-- Menu -->
		<section id="menu"></section>

		<!-- Main -->
		<div id="main">

			<div id="blogPost">
			</div>

			<script id="blog-post-template" type="text/x-handlebars-template">
                <article class="post">
                <header>
                    <div class="title">
                        <h2>{{title}}</h2>
                        <p>{{subTitle}}</p>
                    </div>
                    <div class="meta">
                        <time class="published" datetime="2015-10-18">{{date}}</time>
                        <a href="#" class="author"><span class="name">{{author}}</span><img src={{authorImage}} alt="" /></a>
                    </div>
                </header>
                <!-- <span class="image featured"><img src={{featureImage}} alt="" /></span> -->
                {{{content}}}

				
<p>If you have worked with SQL based database, I guess y'all are familiar with <strong>usage of foreign keys to manage relationship between tables</strong>.</p>
<hr/>

<h2>Relationship Types</h2>
<p>Lets dive into a famous example involving book - author connection to gain insight. There are variety of connection between these entities, in a graphical:</p>

<div class="box alt">
	<div class="row gtr-uniform">
		<div class="col-12"><span class="image fit"><img src="/sql-foreign-keys/relationship.png" alt="" /></span>
		</div>
	</div>
</div>

<section>
	<div class="row">
		<div class="col-12 col-12-medium">
			<ul>
				<li><strong>One to One</strong> → an author can write only one book, and a book only have one author..</li>
				<li><strong>One to Many</strong> → an author can write multiple books, but book can only have one author..</li>
				<li><strong>Many to Many</strong> →an author can write multiple books, and also a book can be written by multiple authors.</li>
			</ul>
		</div>
	</div>
</section>

<p>Lets look into above scenarios for ease of this tutorial, even though some scenarios doesn't seem accurate in real world.</p>
<p>SQL snippets found in this article is written to support SQLite and can be tested in <a href="https://sqliteonline.com/">https://sqliteonline.com</a>.</p>
<hr/>

<h3>One-to-One relationship</h3>
<p>Each of author and book table will have <strong>primary keys</strong> to identify each value uniquely. <strong>Author</strong> table will have
<strong>Pk_author_id</strong>, and <strong>Book</strong> table will have <strong>Pk_book_Id</strong> as unique identifier for each table.
To form relationship between two tables, foreign key references should be added. Here each entry in <strong>Book</strong> table, it will refer
<strong>author_Id</strong> to keep track of connected entry identifier in <strong>Author</strong> table.</p>

<p>Lets dig into SQL code as to how it can be done:</p>
<pre><code>CREATE TABLE Author (
   Pk_author_id INTEGER PRIMARY KEY AUTOINCREMENT,
   Name TEXT,
   Country TEXT
);
CREATE TABLE Book (
   Pk_book_Id INTEGER PRIMARY KEY AUTOINCREMENT,
   Title TEXT,
   Fk_author_Id INTEGER UNIQUE,
   FOREIGN KEY (Fk_author_Id) REFERENCES Author(Pk_author_id)
);</code></pre>
<p>Here when setting up Book table, a connection to author is attached via an id. Lets add some values to test one-to-one relationship.</p>
<pre><code>INSERT INTO Author (Name, Country) VALUES ('Leo Tolstoy', 'Russia');
INSERT INTO Book (Title, Fk_author_Id) VALUES ('War & Peace', 1);</code></pre>
<p>Thereby after inserting these values, formed relationship can be queried:</p>
<pre><code>SELECT Book.Title, Author.Name, Author.Country
FROM Book INNER JOIN Author
ON Author.Pk_author_id = Book.Fk_author_Id</code></pre>

<p><span class="image left"><img src="/sql-foreign-keys/one-to-one.png" alt="" /></span>
However since this is one-to-one relationship implementation, there should be restriction of adding another book for this author.</p>
<pre><code>INSERT INTO Book (Title, Fk_author_Id) VALUES ('Anna Karenina', 1);
→ Results in UNIQUE constraint failed: Book.Fk_author_Id</code></pre>
<p>Due to <strong>UNIQUE</strong> keyword introduced to <strong>Fk_author_Id</strong> attribute in Book table, it would restrict adding 
any record by used author_Id. Thereby making it one-to-one relationship.</p>
<hr/>

<h3>One-to-Many relationship</h3>
<p>Building upon previous example, this scenario should allow an author to write multiple books. By looking into how
one-to-one relationship was implemented using UNIQUE keyword, it can be seen that <strong>removing UNIQUE keyword</strong> would make it
one-to-many relationship. Book table should have been created as such.</p>
<pre><code>CREATE TABLE Book (
   Pk_book_Id INTEGER PRIMARY KEY AUTOINCREMENT,
   Title TEXT,
   Fk_author_Id INTEGER,
   FOREIGN KEY (Fk_author_Id) REFERENCES Author(Pk_author_id)
)</code></pre>
<p>And add values as such without facing an issue like previously.</p>
<pre><code>INSERT INTO Author (Name, Country) VALUES ('Leo Tolstoy', 'Russia');
INSERT INTO Book (Title, Fk_author_Id) VALUES ('War & Peace', 1);
INSERT INTO Book (Title, Fk_author_Id) VALUES ('Anna Karenina', 1);</code></pre>
<p><span class="image left"><img src="/sql-foreign-keys/one-to-many.png" alt="" /></span>
Lets query and see that one-to-many relationship exists. Here an author have been attached to multiple books.</p><br/>
<hr/>

<h3>Many-to-Many relationship</h3>
<p>Simply in this occasion an author can be attached to multiple books, and a book can be attached to multiple authors. This is more closer to real world.</p>
<p>In document based databases such as MongoDB or such this can be simple due to usage of array. Simple example can be as follows:</p>
<pre><code>// Authors
{ Id: 1, Name: 'Larry Bird', BookIds: [1] }
{ Id: 2, Name: 'Magic Johnson', BookIds: [1,2] }
// Books
{ Id: 1, Title: 'When the game was ours', AuthorIds: [1, 2] }
{ Id: 2, Title: 'Drive', AuthorIds: [1] }</code></pre>
<p>With just using flexibility of NoSQL and arrays many-to-many relationship is simply made. However due to unavailability
of array in SQL, different approach is taken to handle such relationship </p>
<p>In order to create many-to-many relationship, a join table is created to record unique identifiers of connected values.
As per example in order to join <strong>Book</strong> and <strong>Author</strong> tables, another table called <strong>Author_Book</strong> is created.</p>
<section>
	<div class="box alt">
		<div class="row gtr-uniform">
			<div class="col-2"></div>
			<div class="col-6"><span class="image fit"><img src="/sql-foreign-keys/many-to-many.png" alt="" /></span>
			</div>
			<div class="col-2"></div>
		</div>
	</div>
</section>
<p>Lets create two simple tables without any relationship for <strong>Book</strong> and <strong>Author</strong>.</p>
<pre><code>CREATE TABLE Author (
   Pk_author_id INTEGER PRIMARY KEY AUTOINCREMENT,
   Name TEXT,
   Country TEXT
);
CREATE TABLE Book (
   Pk_book_Id INTEGER PRIMARY KEY AUTOINCREMENT,
   Title TEXT
);</code></pre>
<p>Then create joining table, adding parent tables’ primary keys as foreign keys in join table. Additional property related
to relationship can also be stored here such as <strong>Extra_value</strong>.</p>
<pre><code>CREATE TABLE Author_Book (
   Fk_author_id INTEGER NOT NULL,
   Fk_book_id INTEGER NOT NULL,
   Extra_value TEXT,
   FOREIGN KEY (Fk_author_id) REFERENCES Author(Pk_author_id),
   FOREIGN KEY (Fk_book_id) REFERENCES Book(Pk_book_Id),
   PRIMARY KEY (Fk_author_id, Fk_book_id)
);</code></pre>
<p>Each entry in this join table, will include primary keys of parent tables. As an example, <strong>Fk_author_id</strong> is unique
identifier in <strong>Author</strong> table, and <strong>Fk_book_id</strong> is unique identifier in <strong>Book</strong> table.
Thereby <strong>(Fk_author_id, Fk_book_id)</strong> tuple or composite key will be unique itself, and thereby separate unique identifier or
primary key for <strong>Author_Book</strong> is not essential. However integer auto incrementing value can be added as primary key, but it’ll be redundant.</p>
<p>Here this table just contains each combination of given many-to-many relationship. Lets enter some data and query.</p>
<pre><code>INSERT INTO Author (Pk_author_id, name, country)
   VALUES (1, 'Larry Bird', 'USA');
INSERT INTO Author (Pk_author_id, name, country)
   VALUES (2, 'Magic Johnson', 'USA');
INSERT INTO Book (Pk_book_Id, Title)
   VALUES (1, 'When the game was ours');
INSERT INTO Book (Pk_book_Id, Title)
   VALUES (2, 'Drive');</code></pre>
<p>Lets add many-to-many relationship between them:</p>
<pre><code>INSERT INTO Author_Book(Fk_author_id, Fk_book_id) VALUES (1, 1);
INSERT INTO Author_Book(Fk_author_id, Fk_book_id) VALUES (2, 1);
INSERT INTO Author_Book(Fk_author_id, Fk_book_id) VALUES (1, 2);</code></pre>
<p>Lets query the database by join all three tables and extract required values:</p>
<section><div class="box alt"><div class="row gtr-uniform">
	<div class="col-2"></div>
	<div class="col-6"><span class="image fit"><img src="/sql-foreign-keys/join-table.png" alt="" /></span>
	</div>
	<div class="col-2"></div>
</div></div></section>
<pre><code>SELECT Author.Name AS 'Name', Book.Title AS 'Title'
FROM Author, Book, Author_Book
WHERE Author.Pk_author_id = Author_Book.Fk_author_id
AND Book.Pk_book_Id = Author_Book.Fk_book_id;</code></pre>
<hr/>


<h2>Foreign Key Constraints</h2>
<p>Here connections are made between tables, and now records are connected. Now lets try to remove these connection:</p>
<pre><code>DELETE FROM Author WHERE Name="Larry Bird";</code></pre>
<p>Here <strong>Author</strong> value is deleted without any issue, but these raises concern about relationships made. Thereby inconsistent
data is still available, such as this author already referred in <strong>Author_Book</strong>.</p>
<p>SQL allows functionality to avoid such inconsistent data, by disabling or handling such deletion. <strong>Foreign key constraints</strong>
 are there to handle it, and lets create new tables to test these.</p>
<hr/>

<h3>RESTRICT</h3>
<p>Restricting any deletion of references can be an approach foreign keys constraints can be added.</p>
<pre><code>DROP TABLE IF EXISTS Book;
DROP TABLE IF EXISTS Author;
CREATE TABLE Author(AuthorId INTEGER PRIMARY KEY, Name TEXT);
CREATE TABLE Book(BookId INTEGER PRIMARY KEY, Title TEXT,
    AuthorId INTEGER, 
    FOREIGN KEY(AuthorId) REFERENCES Author(AuthorId));
INSERT INTO Author VALUES (1, 'Leo Tolstoy');
INSERT INTO Book VALUES (1,'War & Peace',1);
INSERT INTO Book VALUES (2,'Anna Karenia',1);</code></pre>
<p>Enable foreign key constraints and try to delete connected record.</p>
<pre><code>PRAGMA foreign_keys=1;
   → Enable foreign keys constraints in SQLite.
DELETE FROM Author WHERE AuthorId=1;
   → FOREIGN KEY constraint failed, Due to Books for that Author.
DELETE FROM Book WHERE AuthorId=1;
   → Books related to that Author deleted without an issue.
DELETE FROM Author WHERE AuthorId=1;
   → Author can be deleted now, as related books are deleted.</code></pre>
<p>As seen when foreign keys constraints are enforced, any deletion or updates are not allowed. That behavior is called
<strong>RESTRICT</strong>, added by default.</p>
<hr/>

<h3>ON DELETE CASCADE</h3>
<p>However when creating the table, required behavior for foreign key constraints can be decided. Such action is <strong>ON DELETE CASCADE</strong>,
 which indicates that action (DELETE) should be propagated by related foreign keys from parent table (Author) to
child table (Book). Simply if parent value is deleted, all other records keeping reference to that parent value is to be
deleted.</p>
<pre><code>CREATE TABLE Book(BookId INTEGER PRIMARY KEY, Title TEXT,
    AuthorId INTEGER, FOREIGN KEY(AuthorId) REFERENCES Author(AuthorId) ON DELETE CASCADE);
   → CREATE Book table as above with condition
SELECT Title, Name FROM Author, Book;
   → Add data as added previously.
DELETE FROM Author WHERE AuthorId=1;
   → No foreign key violation invoked. Deleting from Author & Book</code></pre>
<hr/>

<h3>ON DELETE SET NULL</h3>
<p>If values on child tables, are <strong>not to be deleted but rather be altered</strong> according to deleted values in parent table this
approach can be used. Here references in child table to parent table will be set to null, and row wouldn't be deleted.</p>
<pre><code>CREATE TABLE Book(BookId INTEGER PRIMARY KEY, Title TEXT,
    AuthorId INTEGER, FOREIGN KEY(AuthorId) REFERENCES Author(AuthorId) ON DELETE SET NULL);
DELETE FROM Author WHERE AuthorId=1;
   → No foreign key violation invoked.
   → Deleting from Author. Set null in Book.
SELECT * FROM Book;</code></pre>
<section><div class="box alt"><div class="row gtr-uniform">
	<div class="col-2"></div>
	<div class="col-6"><span class="image fit"><img src="/sql-foreign-keys/delete-on-null.png" alt="" /></span>
	</div>
	<div class="col-2"></div>
</div></div></section>
<p>Moreover, it should be noted that restriction happened only when deleting from Author table, and not from Book table.
This is the expected behavior where <strong>foreign key relationship is only one way</strong>, from parent table (Author) towards child
table (Book). Here Book can’t be created unless Author is explicitly connected, and at deletion Book wouldn't be
referred in any other tables. However when trying to delete Author, it could be referred elsewhere in Book table, so
constraints applied.</p>
<hr/>

<p>From this <strong>SQL Snippet</strong>, I think y’all are able to insight into managing data relationship in SQL database tables. Note
that SQLite code segments are used here, and other implementation might vary little.</p>


                </article>
            </script>

		</div>


		<!-- Footer -->
		<section id="footer"></section>
	</div>

	<!-- Scripts -->
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/browser.min.js"></script>
	<script src="/assets/js/breakpoints.min.js"></script>
	<script src="/assets/js/util.js"></script>
	<script src="/assets/js/main.js"></script>
	<script src="/assets/js/handlebars.min-v4.2.1.js"></script>
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
	<script src="/content.js"></script>

	<script>
		$(document).ready(function () {
			var blogPost = $("#blog-post-template").html();
			var blogPostTemplate = Handlebars.compile(blogPost);
			$('#blogPost').append(blogPostTemplate(post_sql_foreign_keys));

			hljs.initHighlightingOnLoad();

			$.get('/template/header.hbs', function (data) {
				var headerTemplate = Handlebars.compile(data);
				$("#header").html(headerTemplate());
			}, 'html')

			$.get('/template/menu.hbs', function (data) {
				var menuTemplate = Handlebars.compile(data);
				$("#menu").html(menuTemplate());
			}, 'html')

			$.get('/template/footer.hbs', function (data) {
				var footerTemplate = Handlebars.compile(data);
				$("#footer").html(footerTemplate());
			}, 'html')

		});
	</script>
</body>

</html>